<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Health Companion - Your Personal Doctor & Therapist</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; color: white; margin-bottom: 1.5rem; }
        header h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .disclaimer { background: rgba(255,243,205,0.9); color: #856404; padding: 0.5rem 1rem; border-radius: 5px; display: inline-block; font-size: 0.85rem; }
        
        /* Tabs */
        .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; justify-content: center; }
        .tab-btn { padding: 0.75rem 1.5rem; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; }
        .tab-btn:hover, .tab-btn.active { background: white; color: #667eea; }
        
        /* Tab Content */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Cards */
        .card { background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); margin-bottom: 1rem; }
        .card h3 { color: #667eea; margin-bottom: 1rem; font-size: 1.3rem; }
        
        /* Chat Styles */
        #chatMessages { height: 350px; overflow-y: auto; background: #f8f9fa; padding: 1rem; border-radius: 10px; margin-bottom: 1rem; }
        .message { padding: 0.75rem 1rem; margin: 0.5rem 0; border-radius: 15px; max-width: 85%; }
        .user-msg { background: linear-gradient(135deg, #667eea, #764ba2); color: white; margin-left: auto; }
        .ai-msg { background: #e9ecef; }
        .chat-input-row { display: flex; gap: 0.5rem; }
        #chatInput { flex: 1; padding: 0.75rem 1rem; border: 2px solid #e0e0e0; border-radius: 25px; font-size: 1rem; }
        #chatInput:focus { outline: none; border-color: #667eea; }
        
        /* Mode Selector */
        .mode-selector { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .mode-btn { padding: 0.5rem 1rem; background: #f0f0f0; border: 2px solid transparent; border-radius: 20px; cursor: pointer; font-size: 0.85rem; transition: all 0.3s; }
        .mode-btn:hover { border-color: #667eea; }
        .mode-btn.active { background: #667eea; color: white; }
        
        /* Forms */
        .grid-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .form-group { margin-bottom: 0.75rem; }
        .form-group label { display: block; margin-bottom: 0.3rem; font-weight: 600; color: #333; font-size: 0.9rem; }
        .form-group input, .form-group select { width: 100%; padding: 0.6rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        
        /* Buttons */
        .btn { padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 1rem; transition: transform 0.2s; }
        .btn:hover { transform: scale(1.02); }
        
        /* Results */
        .result-box { margin-top: 1rem; padding: 1rem; border-radius: 10px; }
        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }
        
        /* Quick Actions */
        .quick-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem; }
        .quick-btn { padding: 0.4rem 0.8rem; background: #f0f0f0; border: none; border-radius: 15px; cursor: pointer; font-size: 0.8rem; }
        .quick-btn:hover { background: #667eea; color: white; }
        
        /* Two Column Layout */
        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        @media (max-width: 768px) { .two-col { grid-template-columns: 1fr; } }
        
        /* Auth Styles */
        .auth-bar { display: flex; justify-content: flex-end; gap: 0.5rem; margin-bottom: 0.5rem; }
        .auth-btn { padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 0.85rem; }
        .auth-btn:hover { background: rgba(255,255,255,0.4); }
        .auth-btn.logout { background: rgba(255,100,100,0.3); }
        .user-info { color: white; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 2rem; border-radius: 15px; max-width: 400px; width: 90%; }
        .modal-content h2 { color: #667eea; margin-bottom: 1.5rem; text-align: center; }
        .modal-tabs { display: flex; margin-bottom: 1.5rem; }
        .modal-tab { flex: 1; padding: 0.75rem; background: #f0f0f0; border: none; cursor: pointer; }
        .modal-tab:first-child { border-radius: 8px 0 0 8px; }
        .modal-tab:last-child { border-radius: 0 8px 8px 0; }
        .modal-tab.active { background: #667eea; color: white; }
        .modal-form { display: none; }
        .modal-form.active { display: block; }
        .modal-form .form-group { margin-bottom: 1rem; }
        .modal-form input { width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; }
        .modal-form input:focus { outline: none; border-color: #667eea; }
        .modal-form .btn { width: 100%; margin-top: 0.5rem; }
        .close-modal { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #999; }
        .error-msg { color: #dc3545; font-size: 0.85rem; margin-top: 0.5rem; }
        .success-msg { color: #28a745; font-size: 0.85rem; margin-top: 0.5rem; }
        .loading { text-align: center; padding: 1rem; color: #667eea; }
    </style>
</head>
<body>
    <!-- Auth Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content" style="position: relative;">
            <span class="close-modal" onclick="closeAuthModal()">&times;</span>
            <h2>üè• Welcome</h2>
            <div class="modal-tabs">
                <button class="modal-tab active" onclick="showAuthTab('login')">Login</button>
                <button class="modal-tab" onclick="showAuthTab('register')">Register</button>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="modal-form active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <div id="loginError" class="error-msg"></div>
                <button type="submit" class="btn">Login</button>
            </form>
            
            <!-- Register Form -->
            <form id="registerForm" class="modal-form" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="name" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" placeholder="Min 6 characters" required minlength="6">
                </div>
                <div id="registerError" class="error-msg"></div>
                <div id="registerSuccess" class="success-msg"></div>
                <button type="submit" class="btn">Create Account</button>
            </form>
        </div>
    </div>

    <div class="container">
        <!-- Auth Bar -->
        <div class="auth-bar">
            <div id="authStatus">
                <button class="auth-btn" onclick="openAuthModal()">üîê Login / Register</button>
            </div>
        </div>
        
        <header>
            <h1>üè• AI Health Companion</h1>
            <p>Your Personal Doctor, Therapist & Health Assistant</p>
            <p class="disclaimer">‚ö†Ô∏è For informational purposes only. Always consult real healthcare professionals for medical decisions.</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('chat')">üí¨ Health Chat</button>
            <button class="tab-btn" onclick="showTab('diabetes')">ü©∏ Diabetes Check</button>
            <button class="tab-btn" onclick="showTab('heart')">‚ù§Ô∏è Heart Health</button>
            <button class="tab-btn" onclick="showTab('pcos')">üå∏ PCOS Check</button>
            <button class="tab-btn" onclick="showTab('mental')">üß† Mental Wellness</button>
        </div>

        <!-- Chat Tab -->
        <div id="chat" class="tab-content active">
            <div class="card">
                <h3>üí¨ Talk to Your AI Health Companion</h3>
                
                <div class="mode-selector">
                    <button class="mode-btn active" onclick="setMode('general')">üè• General Health</button>
                    <button class="mode-btn" onclick="setMode('physical')">ü©∫ Physical Symptoms</button>
                    <button class="mode-btn" onclick="setMode('mental')">üß† Mental Health</button>
                    <button class="mode-btn" onclick="setMode('nutrition')">ü•ó Diet & Nutrition</button>
                    <button class="mode-btn" onclick="setMode('fitness')">üí™ Fitness</button>
                </div>

                <div class="quick-actions">
                    <button class="quick-btn" onclick="askQuick('I have a headache')">ü§ï Headache</button>
                    <button class="quick-btn" onclick="askQuick('I feel anxious')">üò∞ Anxiety</button>
                    <button class="quick-btn" onclick="askQuick('I cant sleep')">üò¥ Sleep Issues</button>
                    <button class="quick-btn" onclick="askQuick('I feel tired all the time')">üò´ Fatigue</button>
                    <button class="quick-btn" onclick="askQuick('I want to lose weight')">‚öñÔ∏è Weight Loss</button>
                    <button class="quick-btn" onclick="askQuick('I feel sad and unmotivated')">üò¢ Feeling Down</button>
                </div>

                <div id="chatMessages">
                    <div class="message ai-msg">
                        üëã Hello! I'm your AI Health Companion - your personal doctor and therapist assistant.<br><br>
                        üè• <strong>Physical Health:</strong> Discuss symptoms, get health advice<br>
                        üß† <strong>Mental Wellness:</strong> Talk about stress, anxiety, emotions<br>
                        ü•ó <strong>Nutrition:</strong> Diet tips and meal guidance<br>
                        üí™ <strong>Fitness:</strong> Exercise recommendations<br><br>
                        How are you feeling today? I'm here to listen and help! üíö
                    </div>
                </div>
                <div class="chat-input-row">
                    <input type="text" id="chatInput" placeholder="Tell me how you're feeling or ask any health question...">
                    <button class="btn" onclick="sendChat()">Send</button>
                </div>
            </div>
        </div>

        <!-- Diabetes Tab -->
        <div id="diabetes" class="tab-content">
            <div class="card">
                <h3>ü©∏ Diabetes Risk Assessment</h3>
                <p style="margin-bottom: 1rem; color: #666;">Powered by ML model trained on PIMA Indians dataset (ROC-AUC: 0.829)</p>
                <form id="diabetesForm" class="grid-form">
                    <div class="form-group">
                        <label>Pregnancies (0 if male)</label>
                        <input type="number" name="pregnancies" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>Glucose Level (mg/dL)</label>
                        <input type="number" name="glucose" placeholder="Fasting: 70-100 normal" required>
                    </div>
                    <div class="form-group">
                        <label>Blood Pressure (mm Hg)</label>
                        <input type="number" name="blood_pressure" placeholder="Normal: 80-120" required>
                    </div>
                    <div class="form-group">
                        <label>Skin Thickness (mm)</label>
                        <input type="number" name="skin_thickness" value="20">
                    </div>
                    <div class="form-group">
                        <label>Insulin (ŒºU/mL)</label>
                        <input type="number" name="insulin" value="80">
                    </div>
                    <div class="form-group">
                        <label>BMI (kg/m¬≤)</label>
                        <input type="number" step="0.1" name="bmi" placeholder="Normal: 18.5-24.9" required>
                    </div>
                    <div class="form-group">
                        <label>Diabetes Pedigree Function</label>
                        <input type="number" step="0.01" name="diabetes_pedigree" value="0.5" placeholder="Family history factor">
                    </div>
                    <div class="form-group">
                        <label>Age</label>
                        <input type="number" name="age" placeholder="Your age" required>
                    </div>
                </form>
                <button type="submit" class="btn" onclick="checkDiabetes(event)">Check Diabetes Risk</button>
                <div id="diabetesResult"></div>
            </div>
        </div>

        <!-- Heart Tab -->
        <div id="heart" class="tab-content">
            <div class="card">
                <h3>‚ù§Ô∏è Heart Disease Risk Assessment</h3>
                <p style="margin-bottom: 1rem; color: #666;">Powered by ML model trained on UCI Heart Disease dataset (ROC-AUC: 0.947)</p>
                <form id="heartForm" class="grid-form">
                    <div class="form-group">
                        <label>Age</label>
                        <input type="number" name="age" min="20" max="100" placeholder="Your age" required>
                    </div>
                    <div class="form-group">
                        <label>Sex</label>
                        <select name="sex" required>
                            <option value="1">Male</option>
                            <option value="0">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Chest Pain Type</label>
                        <select name="cp" required>
                            <option value="0">Typical Angina</option>
                            <option value="1">Atypical Angina</option>
                            <option value="2">Non-anginal Pain</option>
                            <option value="3">Asymptomatic</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Resting Blood Pressure (mm Hg)</label>
                        <input type="number" name="trestbps" min="80" max="200" placeholder="Normal: 120" required>
                    </div>
                    <div class="form-group">
                        <label>Cholesterol (mg/dL)</label>
                        <input type="number" name="chol" min="100" max="600" placeholder="Normal: <200" required>
                    </div>
                    <div class="form-group">
                        <label>Fasting Blood Sugar > 120?</label>
                        <select name="fbs">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Resting ECG Results</label>
                        <select name="restecg">
                            <option value="0">Normal</option>
                            <option value="1">ST-T Wave Abnormality</option>
                            <option value="2">Left Ventricular Hypertrophy</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Max Heart Rate Achieved</label>
                        <input type="number" name="thalach" min="60" max="220" placeholder="During exercise" required>
                    </div>
                    <div class="form-group">
                        <label>Exercise Induced Angina</label>
                        <select name="exang">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ST Depression (oldpeak)</label>
                        <input type="number" step="0.1" name="oldpeak" min="0" max="6" value="0" placeholder="0-6">
                    </div>
                    <div class="form-group">
                        <label>Slope of Peak Exercise ST</label>
                        <select name="slope">
                            <option value="0">Upsloping</option>
                            <option value="1">Flat</option>
                            <option value="2">Downsloping</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Major Vessels (Fluoroscopy)</label>
                        <select name="ca">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Thalassemia</label>
                        <select name="thal">
                            <option value="2">Normal</option>
                            <option value="1">Fixed Defect</option>
                            <option value="3">Reversible Defect</option>
                        </select>
                    </div>
                </form>
                <button class="btn" onclick="checkHeart(event)">Check Heart Health</button>
                <div id="heartResult"></div>
            </div>
        </div>

        <!-- PCOS Tab -->
        <div id="pcos" class="tab-content">
            <div class="card">
                <h3>üå∏ PCOS Risk Assessment</h3>
                <p style="margin-bottom: 1rem; color: #666;">Polycystic Ovary Syndrome screening powered by ML model (ROC-AUC: 0.795)</p>
                <form id="pcosForm" class="grid-form">
                    <div class="form-group">
                        <label>Age</label>
                        <input type="number" name="age" min="15" max="50" placeholder="15-50 years" required>
                    </div>
                    <div class="form-group">
                        <label>Weight (kg)</label>
                        <input type="number" step="0.1" name="weight" min="30" max="150" placeholder="Weight in kg" required>
                    </div>
                    <div class="form-group">
                        <label>BMI (kg/m¬≤)</label>
                        <input type="number" step="0.1" name="bmi" min="15" max="50" placeholder="Normal: 18.5-24.9" required>
                    </div>
                    <div class="form-group">
                        <label>Menstrual Cycle Pattern</label>
                        <select name="cycle_length" required>
                            <option value="1">Regular (21-35 days)</option>
                            <option value="2">Slightly Irregular</option>
                            <option value="3">Irregular</option>
                            <option value="4">Very Irregular/Absent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Cycle Regularity</label>
                        <select name="cycle_regularity">
                            <option value="0">Regular</option>
                            <option value="1">Irregular</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Recent Weight Gain (Unexplained)</label>
                        <select name="weight_gain">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Excess Facial/Body Hair</label>
                        <select name="hair_growth">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Skin Darkening (Acanthosis)</label>
                        <select name="skin_darkening">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Persistent Acne</label>
                        <select name="pimples">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Regular Fast Food Consumption</label>
                        <select name="fast_food">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Regular Exercise</label>
                        <select name="regular_exercise">
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                </form>
                <button class="btn" onclick="checkPCOS(event)">Check PCOS Risk</button>
                <div id="pcosResult"></div>
            </div>
        </div>

        <!-- Mental Wellness Tab -->
        <div id="mental" class="tab-content">
            <div class="two-col">
                <div class="card">
                    <h3>üß† Mental Wellness Check</h3>
                    <p style="margin-bottom: 1rem; color: #666;">How have you been feeling over the past 2 weeks?</p>
                    <form id="mentalForm">
                        <div class="form-group">
                            <label>Feeling down, depressed, or hopeless?</label>
                            <select name="q1"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select>
                        </div>
                        <div class="form-group">
                            <label>Little interest or pleasure in doing things?</label>
                            <select name="q2"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select>
                        </div>
                        <div class="form-group">
                            <label>Feeling nervous, anxious, or on edge?</label>
                            <select name="q3"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select>
                        </div>
                        <div class="form-group">
                            <label>Trouble falling or staying asleep?</label>
                            <select name="q4"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select>
                        </div>
                        <div class="form-group">
                            <label>Feeling tired or having little energy?</label>
                            <select name="q5"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select>
                        </div>
                        <button type="button" class="btn" onclick="checkMental()">Assess My Wellness</button>
                    </form>
                    <div id="mentalResult"></div>
                </div>
                <div class="card">
                    <h3>üåü Self-Care Resources</h3>
                    <div style="line-height: 2;">
                        <p>üßò <strong>Breathing Exercise:</strong> Try 4-7-8 breathing</p>
                        <p>üö∂ <strong>Movement:</strong> 10-min walk can boost mood</p>
                        <p>üìù <strong>Journaling:</strong> Write 3 things you're grateful for</p>
                        <p>üéµ <strong>Music:</strong> Listen to calming music</p>
                        <p>üí§ <strong>Sleep:</strong> Maintain consistent sleep schedule</p>
                        <p>ü§ù <strong>Connection:</strong> Reach out to someone you trust</p>
                    </div>
                    <hr style="margin: 1rem 0;">
                    <p style="color: #dc3545;"><strong>üÜò Crisis Resources:</strong></p>
                    <p>If you're in crisis, please contact:</p>
                    <p>üìû iCall: 9152987821</p>
                    <p>üìû Vandrevala Foundation: 1860-2662-345</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000/api/v1';
        let chatMode = 'general';

        // ==================== AUTHENTICATION ====================
        
        function openAuthModal() {
            document.getElementById('authModal').classList.add('active');
        }
        
        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('loginError').textContent = '';
            document.getElementById('registerError').textContent = '';
            document.getElementById('registerSuccess').textContent = '';
        }
        
        function showAuthTab(tab) {
            document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.modal-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelector('.modal-tab:first-child').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelector('.modal-tab:last-child').classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }
        
        async function handleLogin(e) {
            e.preventDefault();
            const form = e.target;
            const email = form.email.value;
            const password = form.password.value;
            const errorDiv = document.getElementById('loginError');
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: `username=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Login failed');
                }
                
                const data = await response.json();
                localStorage.setItem('authToken', data.access_token);
                localStorage.setItem('userEmail', email);
                
                updateAuthStatus(true, email);
                closeAuthModal();
                
            } catch (error) {
                errorDiv.textContent = error.message;
            }
        }
        
        async function handleRegister(e) {
            e.preventDefault();
            const form = e.target;
            const name = form.name.value;
            const email = form.email.value;
            const password = form.password.value;
            const errorDiv = document.getElementById('registerError');
            const successDiv = document.getElementById('registerSuccess');
            
            errorDiv.textContent = '';
            successDiv.textContent = '';
            
            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ full_name: name, email, password })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Registration failed');
                }
                
                successDiv.textContent = '‚úÖ Account created! Please login.';
                form.reset();
                
                // Switch to login tab after 1.5 seconds
                setTimeout(() => showAuthTab('login'), 1500);
                
            } catch (error) {
                errorDiv.textContent = error.message;
            }
        }
        
        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userEmail');
            updateAuthStatus(false);
        }
        
        function updateAuthStatus(isLoggedIn, email = '') {
            const authStatus = document.getElementById('authStatus');
            
            if (isLoggedIn) {
                authStatus.innerHTML = `
                    <span class="user-info">üë§ ${email}</span>
                    <button class="auth-btn logout" onclick="logout()">Logout</button>
                `;
            } else {
                authStatus.innerHTML = `
                    <button class="auth-btn" onclick="openAuthModal()">üîê Login / Register</button>
                `;
            }
        }
        
        function isLoggedIn() {
            return !!localStorage.getItem('authToken');
        }
        
        function getAuthToken() {
            return localStorage.getItem('authToken');
        }
        
        // Check auth status on page load
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('authToken');
            const email = localStorage.getItem('userEmail');
            if (token && email) {
                updateAuthStatus(true, email);
            }
        });

        // ==================== TAB NAVIGATION ====================
        
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }


        // Chat Mode
        function setMode(mode) {
            chatMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            const prompts = {
                general: "I'm now in general health mode. How can I help you?",
                physical: "I'm now your physical health assistant. Describe any symptoms you're experiencing.",
                mental: "I'm here as your mental wellness companion. How are you feeling emotionally?",
                nutrition: "I'm your nutrition advisor. Ask me about diet, meals, or healthy eating!",
                fitness: "I'm your fitness guide. What are your exercise goals?"
            };
            addMessage(prompts[mode], 'ai');
        }

        function askQuick(question) {
            document.getElementById('chatInput').value = question;
            sendChat();
        }

        function addMessage(text, type) {
            const chatDiv = document.getElementById('chatMessages');
            chatDiv.innerHTML += `<div class="message ${type}-msg">${text}</div>`;
            chatDiv.scrollTop = chatDiv.scrollHeight;
        }

        async function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            input.value = '';
            
            const typingId = 'typing-' + Date.now();
            addMessage('<em>Thinking...</em>', 'ai');
            const typingEl = document.querySelector('#chatMessages .message:last-child');
            typingEl.id = typingId;

            try {
                const response = await fetch(`${API_URL}/chat/public`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: `[Mode: ${chatMode}] ${message}` })
                });

                document.getElementById(typingId)?.remove();

                if (response.ok) {
                    const result = await response.json();
                    addMessage(result.response, 'ai');
                } else {
                    addMessage("I understand you're reaching out. While I process your question, remember that your health matters. Can you tell me more about what you're experiencing?", 'ai');
                }
            } catch (err) {
                document.getElementById(typingId)?.remove();
                addMessage("I'm having trouble connecting, but I'm still here for you. Please try again in a moment.", 'ai');
            }
        }

        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChat();
        });

        // Diabetes Check - Using Real ML Model API (NO AUTH REQUIRED)
        async function checkDiabetes(e) {
            e.preventDefault();
            const form = document.getElementById('diabetesForm');
            const resultDiv = document.getElementById('diabetesResult');
            
            // Show loading state
            resultDiv.innerHTML = '<div class="loading">üîÑ Analyzing with ML model...</div>';
            
            const data = {
                pregnancies: parseInt(form.pregnancies.value) || 0,
                glucose: parseFloat(form.glucose.value),
                blood_pressure: parseFloat(form.blood_pressure.value),
                skin_thickness: parseFloat(form.skin_thickness.value) || 20,
                insulin: parseFloat(form.insulin.value) || 80,
                bmi: parseFloat(form.bmi.value),
                diabetes_pedigree: parseFloat(form.diabetes_pedigree.value) || 0.5,
                age: parseInt(form.age.value)
            };
            
            try {
                const response = await fetch('http://localhost:8000/api/predict/diabetes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Prediction failed');
                }
                
                const result = await response.json();
                const score = Math.round(result.risk_score * 100);
                const riskClass = result.risk_level === 'low' ? 'risk-low' : result.risk_level === 'medium' ? 'risk-medium' : 'risk-high';
                
                let recommendationsHTML = '';
                if (result.recommendations && result.recommendations.length > 0) {
                    recommendationsHTML = '<ul style="text-align: left; margin-top: 10px;">' + 
                        result.recommendations.map(r => `<li>${r}</li>`).join('') + '</ul>';
                }
                
                resultDiv.innerHTML = `
                    <div class="result-box ${riskClass}">
                        <strong>Diabetes Risk Score: ${score}%</strong><br>
                        Risk Level: ${result.risk_level.toUpperCase()}<br>
                        Model Confidence: ${Math.round(result.confidence * 100)}%<br>
                        ${recommendationsHTML}
                        <small style="display: block; margin-top: 10px; color: #666;">
                            ${result.explanation || 'This is a screening tool, not a diagnosis. Please consult a healthcare professional.'}
                        </small>
                    </div>`;
            } catch (error) {
                console.error('Diabetes prediction error:', error);
                resultDiv.innerHTML = `<div class="result-box risk-medium">
                    <strong>Error:</strong> ${error.message}<br>
                    <small>Make sure the backend server is running on localhost:8000</small>
                </div>`;
            }
        }

        // Heart Check - Using Real ML Model API (NO AUTH REQUIRED)
        async function checkHeart(e) {
            e.preventDefault();
            const form = document.getElementById('heartForm');
            const resultDiv = document.getElementById('heartResult');
            
            // Show loading state
            resultDiv.innerHTML = '<div class="loading">üîÑ Analyzing with ML model...</div>';
            
            const data = {
                age: parseInt(form.age.value),
                sex: parseInt(form.sex.value),
                cp: parseInt(form.cp.value),
                trestbps: parseInt(form.trestbps.value),
                chol: parseInt(form.chol.value),
                fbs: parseInt(form.fbs.value),
                restecg: parseInt(form.restecg.value),
                thalach: parseInt(form.thalach.value),
                exang: parseInt(form.exang.value),
                oldpeak: parseFloat(form.oldpeak.value) || 0,
                slope: parseInt(form.slope.value),
                ca: parseInt(form.ca.value),
                thal: parseInt(form.thal.value)
            };
            
            try {
                const response = await fetch('http://localhost:8000/api/predict/heart', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Prediction failed');
                }
                
                const result = await response.json();
                const score = Math.round(result.risk_score * 100);
                const riskClass = result.risk_level === 'low' ? 'risk-low' : result.risk_level === 'medium' ? 'risk-medium' : 'risk-high';
                
                let recommendationsHTML = '';
                if (result.recommendations && result.recommendations.length > 0) {
                    recommendationsHTML = '<ul style="text-align: left; margin-top: 10px;">' + 
                        result.recommendations.map(r => `<li>${r}</li>`).join('') + '</ul>';
                }
                
                resultDiv.innerHTML = `
                    <div class="result-box ${riskClass}">
                        <strong>Heart Disease Risk Score: ${score}%</strong><br>
                        Risk Level: ${result.risk_level.toUpperCase()}<br>
                        Model Confidence: ${Math.round(result.confidence * 100)}%<br>
                        ${recommendationsHTML}
                        <small style="display: block; margin-top: 10px; color: #666;">
                            ${result.explanation || 'This is a screening tool, not a diagnosis. Please consult a cardiologist.'}
                        </small>
                    </div>`;
            } catch (error) {
                console.error('Heart prediction error:', error);
                resultDiv.innerHTML = `<div class="result-box risk-medium">
                    <strong>Error:</strong> ${error.message}<br>
                    <small>Make sure the backend server is running on localhost:8000</small>
                </div>`;
            }
        }

        // PCOS Check - Using Real ML Model API (NO AUTH REQUIRED)
        async function checkPCOS(e) {
            e.preventDefault();
            const form = document.getElementById('pcosForm');
            const resultDiv = document.getElementById('pcosResult');
            
            // Show loading state
            resultDiv.innerHTML = '<div class="loading">üîÑ Analyzing with ML model...</div>';
            
            const data = {
                age: parseInt(form.age.value),
                weight: parseFloat(form.weight.value),
                bmi: parseFloat(form.bmi.value),
                cycle_length: parseInt(form.cycle_length.value),
                cycle_regularity: parseInt(form.cycle_regularity.value),
                weight_gain: parseInt(form.weight_gain.value),
                hair_growth: parseInt(form.hair_growth.value),
                skin_darkening: parseInt(form.skin_darkening.value),
                pimples: parseInt(form.pimples.value),
                fast_food: parseInt(form.fast_food.value),
                regular_exercise: parseInt(form.regular_exercise.value)
            };
            
            try {
                const response = await fetch('http://localhost:8000/api/predict/pcos', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Prediction failed');
                }
                
                const result = await response.json();
                const score = Math.round(result.risk_score * 100);
                const riskClass = result.risk_level === 'low' ? 'risk-low' : result.risk_level === 'medium' ? 'risk-medium' : 'risk-high';
                
                let recommendationsHTML = '';
                if (result.recommendations && result.recommendations.length > 0) {
                    recommendationsHTML = '<ul style="text-align: left; margin-top: 10px;">' + 
                        result.recommendations.map(r => `<li>${r}</li>`).join('') + '</ul>';
                }
                
                resultDiv.innerHTML = `
                    <div class="result-box ${riskClass}">
                        <strong>PCOS Risk Score: ${score}%</strong><br>
                        Risk Level: ${result.risk_level.toUpperCase()}<br>
                        Model Confidence: ${Math.round(result.confidence * 100)}%<br>
                        ${recommendationsHTML}
                        <small style="display: block; margin-top: 10px; color: #666;">
                            ${result.disclaimer || 'This is a screening tool, not a diagnosis. Please consult a healthcare professional.'}
                        </small>
                    </div>`;
            } catch (error) {
                console.error('PCOS prediction error:', error);
                resultDiv.innerHTML = `<div class="result-box risk-medium">
                    <strong>Error:</strong> ${error.message}<br>
                    <small>Make sure the backend server is running on localhost:8000</small>
                </div>`;
            }
        }

        // Mental Check
        function checkMental() {
            const form = document.getElementById('mentalForm');
            let score = 0;
            for (let i = 1; i <= 5; i++) {
                score += parseInt(form[`q${i}`].value);
            }

            const resultDiv = document.getElementById('mentalResult');
            let level, className, message;

            if (score <= 4) {
                level = 'Minimal'; className = 'risk-low';
                message = "Your responses suggest minimal symptoms. Keep up your self-care practices!";
            } else if (score <= 9) {
                level = 'Mild'; className = 'risk-medium';
                message = "You may be experiencing mild symptoms. Consider talking to someone you trust or trying relaxation techniques.";
            } else if (score <= 14) {
                level = 'Moderate'; className = 'risk-medium';
                message = "Your responses suggest moderate symptoms. Consider speaking with a mental health professional.";
            } else {
                level = 'Needs Attention'; className = 'risk-high';
                message = "Your responses suggest you may benefit from professional support. Please reach out to a mental health professional or helpline.";
            }

            resultDiv.innerHTML = `<div class="result-box ${className}">
                <strong>Wellness Level: ${level}</strong><br>
                ${message}<br><br>
                <small>üíö Remember: Seeking help is a sign of strength, not weakness.</small>
            </div>`;
        }

        function showResult(elementId, score, type) {
            const resultDiv = document.getElementById(elementId);
            let level, className, tips;

            if (score >= 50) {
                level = 'HIGH RISK';
                className = 'risk-high';
                tips = 'Please consult a healthcare professional for proper evaluation.';
            } else if (score >= 25) {
                level = 'MODERATE RISK';
                className = 'risk-medium';
                tips = 'Consider lifestyle modifications and regular monitoring.';
            } else {
                level = 'LOW RISK';
                className = 'risk-low';
                tips = 'Maintain your healthy lifestyle! Regular check-ups are still recommended.';
            }

            resultDiv.innerHTML = `<div class="result-box ${className}">
                <strong>${type} Risk: ${level}</strong><br>
                Risk Score: ${score}%<br><br>
                üí° ${tips}<br><br>
                <small>‚ö†Ô∏è This is a screening tool, not a diagnosis. Always consult healthcare professionals.</small>
            </div>`;
        }
    </script>
</body>
</html>